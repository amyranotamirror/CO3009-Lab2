/*
 * led_matrix.c
 *
 *  Created on: Oct 17, 2023
 *      Author: Amyra Nguyen
 */


#include "led_matrix.h"
/* Private function declaration */
int led_matrix_value = 0;
int led_matrix_number[10][NUM_ROW] = {{0x3c,0x7e,0x66,0x66,0x66,0x66,0x7e,0x3c},
									{0x18,0x38,0x78,0x18,0x18,0x18,0x18,0x7e},
									{0x7c,0x7e,0x06,0x1c,0x38,0x60,0x7e,0x7e},
									{0x7c,0x7e,0x06,0x3c,0x3c,0x06,0x7e,0x7c},
									{0x66,0x66,0x66,0x7e,0x3e,0x06,0x06,0x06},
									{0x7e,0x7e,0x60,0x7c,0x7e,0x02,0x7e,0x7c},
									{0x3e,0x7e,0x60,0x7c,0x7e,0x62,0x7e,0x3c},
									{0x7e,0x7e,0x06,0x06,0x06,0x06,0x06,0x06},
									{0x3c,0x7e,0x66,0x3c,0x3c,0x66,0x7e,0x3c},
									{0x3c,0x7e,0x66,0x7e,0x3e,0x06,0x7e,0x7c}};

void set_matrix_row(int row_index){
	if(num >= MIN_NUM && num <= MAX_NUM){
			port->ODR = (port->ODR | led_seg_on[num]) & ~led_seg_off[num];
			return;
		}
		port->ODR = (port->ODR | led_seg_on[10]) & ~led_seg_off[10];

}
void display_matrix_character(int row_index){}
void display_matrix_number(int row_index){}

/* Public function declaration */
void init_led_matrix(){
	matrix_enable_pin[0] = (GPIO_config){ENM0_GPIO_Port, ENM0_Pin};
	matrix_enable_pin[1] = (GPIO_config){ENM1_GPIO_Port, ENM1_Pin};
	matrix_enable_pin[2] = (GPIO_config){ENM2_GPIO_Port, ENM2_Pin};
	matrix_enable_pin[3] = (GPIO_config){ENM3_GPIO_Port, ENM3_Pin};
	matrix_enable_pin[4] = (GPIO_config){ENM4_GPIO_Port, ENM4_Pin};
	matrix_enable_pin[5] = (GPIO_config){ENM5_GPIO_Port, ENM5_Pin};
	matrix_enable_pin[6] = (GPIO_config){ENM6_GPIO_Port, ENM6_Pin};
	matrix_enable_pin[7] = (GPIO_config){ENM7_GPIO_Port, ENM7_Pin};

	matrix_row_pin[0] = (GPIO_config){ROW0_GPIO_Port, ROW0_Pin};
	matrix_row_pin[1] = (GPIO_config){ROW1_GPIO_Port, ROW1_Pin};
	matrix_row_pin[2] = (GPIO_config){ROW2_GPIO_Port, ROW2_Pin};
	matrix_row_pin[3] = (GPIO_config){ROW3_GPIO_Port, ROW3_Pin};
	matrix_row_pin[4] = (GPIO_config){ROW4_GPIO_Port, ROW4_Pin};
	matrix_row_pin[5] = (GPIO_config){ROW5_GPIO_Port, ROW5_Pin};
	matrix_row_pin[6] = (GPIO_config){ROW6_GPIO_Port, ROW6_Pin};
	matrix_row_pin[7] = (GPIO_config){ROW7_GPIO_Port, ROW7_Pin};
}


void updateMatrixBuffer(int value){
	led_matrix_value = value;
}
void updateMatrixRow(int row_index){
	for(uint16_t i = 0; i < NUM_ROW; i++){
		if(i == row_index)
			enable_led_seg(i);
		if(i != row_index)
			disable_led_seg(i);
	}
	if(led_matrix_value > 10)
		display_matrix_character(row_index);
	if(led_matrix_value <= 10 && led_matrix_value >= 0)
		display_matrix_number(row_index);
}
