/*
 * led_matrix.c
 *
 *  Created on: Oct 17, 2023
 *      Author: Amyra Nguyen
 */


#include "led_matrix.h"
/* Private function declaration */
int led_matrix_value = 0;
int led_matrix_number[10][NUM_ROW] = {{0x3C,0x7E,0x66,0x66,0x66,0x66,0x7E,0x3C},
									{0x18,0x38,0x78,0x18,0x18,0x18,0x18,0x7E},
									{0x7C,0x7E,0x06,0x1C,0x38,0x60,0x7E,0x7E},
									{0x7C,0x7E,0x06,0x3C,0x3C,0x06,0x7E,0x7C},
									{0x66,0x66,0x66,0x7E,0x3E,0x06,0x06,0x06},
									{0x7E,0x7E,0x60,0x7C,0x7E,0x02,0x7E,0x7C},
									{0x3E,0x7E,0x60,0x7C,0x7E,0x62,0x7E,0x3C},
									{0x7E,0x7E,0x06,0x06,0x06,0x06,0x06,0x06},
									{0x3C,0x7E,0x66,0x3C,0x3C,0x66,0x7E,0x3C},
									{0x3C,0x7E,0x66,0x7E,0x3E,0x06,0x7E,0x7C}};
int led_matrix_character[26][NUM_ROW] = {};

void enable_matrix_col(int col_index){
	HAL_GPIO_WritePin(matrix_enable_pin[col_index].port, matrix_enable_pin[col_index].pin, GPIO_PIN_RESET);
}
void disable_matrix_col(int col_index){
	HAL_GPIO_WritePin(matrix_enable_pin[col_index].port, matrix_enable_pin[col_index].pin, GPIO_PIN_SET);
}
void display_matrix_character(int row_index){
	GPIOB->ODR = (GPIOB->ODR & (0xFF)) | (led_matrix_character[led_matrix_value][row_index] >> 8);
}
void display_matrix_number(int row_index){
	GPIOB->ODR = (GPIOB->ODR & (0xFF)) | (led_matrix_number[led_matrix_value][row_index] >> 8);
}

/* Public function declaration */
void init_led_matrix(){
	matrix_enable_pin[0] = (GPIO_config){ENM0_GPIO_Port, ENM0_Pin};
	matrix_enable_pin[1] = (GPIO_config){ENM1_GPIO_Port, ENM1_Pin};
	matrix_enable_pin[2] = (GPIO_config){ENM2_GPIO_Port, ENM2_Pin};
	matrix_enable_pin[3] = (GPIO_config){ENM3_GPIO_Port, ENM3_Pin};
	matrix_enable_pin[4] = (GPIO_config){ENM4_GPIO_Port, ENM4_Pin};
	matrix_enable_pin[5] = (GPIO_config){ENM5_GPIO_Port, ENM5_Pin};
	matrix_enable_pin[6] = (GPIO_config){ENM6_GPIO_Port, ENM6_Pin};
	matrix_enable_pin[7] = (GPIO_config){ENM7_GPIO_Port, ENM7_Pin};
}


void updateMatrixBuffer(int value){
	led_matrix_value = value;
}
void updateMatrixRow(int row_index){
	for(uint16_t i = 0; i < NUM_ROW; i++){
		if(i == row_index)
			enable_matrix_col(i);
		if(i != row_index)
			disable_matrix_col(i);
	}
//	if(led_matrix_value > 10)
//		display_matrix_character(row_index);
//	if(led_matrix_value <= 10 && led_matrix_value >= 0)
//		display_matrix_number(row_index);
}
